<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>å­¦ä¹ è¿›åº¦è¿½è¸ª | åŠ æ²¹å¥¥é‡Œç»™</title>
        <style>
            :root {
                color-scheme: dark;
                --primary-color: #6366f1;
                --primary-hover: #4f46e5;
                --secondary-color: #10b981;
                --accent-color: #f59e0b;
                --bg-primary: #111827;
                --bg-secondary: #1f2937;
                --bg-card: #2d3748;
                --text-primary: #f3f4f6;
                --text-secondary: #9ca3af;
                --border-color: #374151;
                --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
                --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
                --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
                --transition-fast: all 0.2s ease;
                --transition-normal: all 0.3s ease;
            }
            
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                margin: 0 auto;
                padding: 2rem;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
                background: linear-gradient(135deg, var(--bg-primary), #0f172a);
                color: var(--text-primary);
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                max-width: 1200px;
            }

            header {
                text-align: center;
                margin-bottom: 2rem;
                animation: fadeInUp 0.6s ease;
            }

            h1 {
                font-size: 2.5rem;
                margin-bottom: 0.5rem;
                background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
                display: inline-block;
            }

            h3, h4 {
                text-align: center;
                margin: 0.5rem 0;
                color: var(--text-secondary);
            }

            a {
                color: var(--primary-color);
                text-decoration: none;
                font-weight: 500;
                transition: var(--transition-fast);
                position: relative;
            }

            a:hover {
                color: var(--primary-hover);
            }

            a::after {
                content: '';
                position: absolute;
                width: 0;
                height: 2px;
                bottom: -2px;
                left: 0;
                background-color: var(--primary-color);
                transition: var(--transition-fast);
            }

            a:hover::after {
                width: 100%;
            }

            .tips {
                text-align: center;
                margin: 1.5rem 0;
                font-size: 1.25rem;
                color: var(--accent-color);
                font-weight: 500;
            }

            .actions {
                margin: 1.5rem 0;
                padding: 1rem;
                background: var(--bg-card);
                border-radius: 0.75rem;
                box-shadow: var(--shadow-md);
                display: flex;
                justify-content: center;
                gap: 1rem;
            }

            .actions a {
                padding: 0.5rem 1rem;
                border-radius: 0.5rem;
                background: var(--bg-secondary);
                transition: var(--transition-normal);
                border: 1px solid transparent;
            }

            .actions a:hover {
                background: var(--primary-color);
                color: white;
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }
            
            .actions a.active {
                background: var(--primary-color);
                color: white;
                box-shadow: var(--shadow-md);
                border-color: var(--primary-hover);
            }

            .card {
                margin: 1.5rem 0;
                padding: 1.5rem;
                background: var(--bg-card);
                border-radius: 0.75rem;
                box-shadow: var(--shadow-md);
                transition: var(--transition-normal);
                border: 1px solid var(--border-color);
                animation: fadeIn 0.5s ease;
            }

            .card:hover {
                box-shadow: var(--shadow-lg);
                transform: translateY(-3px);
                border-color: var(--primary-color);
            }

            .list {
                overflow-x: auto;
            }

            .list table {
                width: 100%;
                border-collapse: separate;
                border-spacing: 0;
                border-radius: 0.5rem;
                overflow: hidden;
                table-layout: fixed;
            }

            .list table thead {
                background: var(--primary-color);
                color: white;
            }

            .list table th {
                padding: 1rem;
                text-align: center;
                font-weight: 600;
                text-transform: uppercase;
                font-size: 0.875rem;
                letter-spacing: 0.05em;
            }

            .list table td {
                padding: 1rem;
                text-align: center;
                border-bottom: 1px solid var(--border-color);
                background: var(--bg-secondary);
                transition: var(--transition-fast);
            }

            .list table tr:last-child td {
                border-bottom: none;
            }

            .list table tr:hover td {
                background: var(--bg-card);
            }

            .list table td:first-child {
                font-weight: 600;
                color: var(--primary-color);
            }

            .login-btn {
                display: inline-block;
                padding: 0.5rem 1rem;
                background: var(--primary-color);
                color: white;
                border-radius: 0.375rem;
                font-weight: 500;
                transition: var(--transition-fast);
                border: none;
                cursor: pointer;
            }

            .login-btn:hover {
                background: var(--primary-hover);
                transform: translateY(-1px);
                box-shadow: var(--shadow-md);
                color: white;
            }

            .login-btn::after {
                display: none;
            }

            .log {
                margin: 1.5rem 0;
                padding: 1rem;
                background: var(--bg-card);
                border-radius: 0.75rem;
                box-shadow: var(--shadow-md);
            }

            .log textarea {
                width: 100%;
                height: 200px;
                background: var(--bg-secondary);
                border-radius: 0.5rem;
                border: 1px solid var(--border-color);
                color: var(--text-primary);
                font-size: 0.875rem;
                resize: vertical;
                font-family: 'Consolas', 'Monaco', monospace;
                outline: none;
                padding: 1rem;
                transition: var(--transition-fast);
            }

            .log textarea:focus {
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            }

            footer {
                margin-top: auto;
                text-align: center;
                padding: 1.5rem 0;
                color: var(--text-secondary);
                font-size: 0.875rem;
            }

            .progress-container {
                width: 100%;
                height: 8px;
                background: var(--bg-secondary);
                border-radius: 4px;
                overflow: hidden;
                margin: 0.5rem 0;
            }

            .progress-bar {
                height: 100%;
                background: linear-gradient(90deg, var(--secondary-color), var(--accent-color));
                border-radius: 4px;
                transition: width 0.6s ease;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @media (max-width: 768px) {
                body {
                    padding: 1rem;
                }
                
                h1 {
                    font-size: 2rem;
                }
                
                .actions {
                    flex-wrap: wrap;
                }
                
                .list table {
                    font-size: 0.875rem;
                }
                
                .list table th,
                .list table td {
                    padding: 0.75rem 0.5rem;
                }
            }

            @media (max-width: 480px) {
                body {
                    padding: 0.75rem;
                }
                
                .card {
                    padding: 1rem;
                }
                
                .list table {
                    font-size: 0.75rem;
                }
                
                .list table th,
                .list table td {
                    padding: 0.5rem 0.25rem;
                }
            }
        </style>
    </head>
    <body>
        <header>
            <h1>ğŸŒŸ å­¦ä¹ è¿›åº¦è¿½è¸ª ğŸŒŸ</h1>
            <h4>æ²¡æœ‰ä½ çš„åå­—ï¼Ÿ<a href="/login">ç«‹å³ç™»å½•</a> å¼€å§‹å­¦ä¹ ä¹‹æ—…ï¼</h4>
        </header>

        <div class="tips">å½“å‰å…±æœ‰ <strong><%= total %></strong> åè€å¸ˆæ­£åœ¨å­¦ä¹ ä¸­</div>
        
        <div class="actions">
            <a href="?status=all" class="filter-btn" data-status="all">å…¨éƒ¨</a>
            <a href="?status=finish" class="filter-btn" data-status="finish">å·²å®Œæˆå­¦ä¹ </a>
            <a href="?status=unfinish" class="filter-btn" data-status="unfinish">è¿›è¡Œä¸­å­¦ä¹ </a>
        </div>
        
        <div class="card list">
            <table>
                <thead>
                    <tr>
                        <th>è€å¸ˆ</th>
                        <th>å·²é€‰/å·²å®Œæˆ/æœªå®Œæˆè¯¾ç¨‹</th>
                        <!-- <th>å·²å®Œæˆè¯¾ç¨‹</th>
                        <th>æœªå®Œæˆè¯¾ç¨‹</th> -->
                        <th>å·²é€‰/å·²è·å­¦åˆ†</th>
                        <!-- <th>å·²è·å­¦åˆ†</th> -->
                        <!-- <th>è¿›åº¦%</th> -->
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <% data.forEach(item=> { 
                        // è®¡ç®—å®Œæˆç™¾åˆ†æ¯”
                        const totalCourses = parseInt(item.courseInfo?.TotalCount || 0);
                        const completedCourses = parseInt(item.courseInfo?.EndCount || 0);
                        const progressPercentage = totalCourses > 0 ? Math.round((completedCourses / totalCourses) * 100) : 0;
                    %>
                    <tr>
                        <td>
                            <%= item.realName %>
                        </td>
                        <td>
                            <%= item.courseInfo?.TotalCount %> /
                            <%= item.courseInfo?.EndCount %> /
                            <%= item.courseInfo?.NotEndCount %>
                        </td>
                        <!-- <td><%= item.courseInfo?.EndCount %></td>
                        <td><%= item.courseInfo?.NotEndCount %></td> -->
                        <td>
                            <%= item.courseInfo?.totalPeriod %> /
                            <%= item.courseInfo?.obtainedValue %>
                        </td>
                        <!-- <td><%= item.courseInfo?.obtainedValue %></td> -->
                        <!-- <td>
                            <div class="progress-container">
                                <div class="progress-bar" style="width: <%= progressPercentage %>%"></div>
                            </div>
                            <span style="font-size: 0.875rem;"><%= progressPercentage %>%</span>
                        </td> -->
                        <td>
                            <a class="login-btn" target="_blank" href="https://www.cdsjxjy.cn/cdcte/#/tokenLogin?token=<%= item.token %>">è¿›å…¥</a>  
                        </td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>

        <div class="card log">
            <h4 style="text-align: left; margin-bottom: 1rem;"><strong>å®æ—¶æ—¥å¿—</strong></h4>
            <textarea name="" id="log-output" readonly></textarea>
        </div>

        <footer>
            <div class="power">âš¡ ç”± å¸…å“¥ç¨‹åºçŒ¿ ğŸ’» å¼€å‘ | ä¸ºå­¦ä¹ åŠ æ²¹åŠ©åŠ› âš¡</div>
        </footer>
        <script>
            // è¿æ¥WebSocketè·å–å®æ—¶æ—¥å¿—
            const ws = new WebSocket("/");
            const logOutput = document.getElementById("log-output");
            
            // ä¼˜åŒ–çš„æ—¥å¿—è‡ªåŠ¨æ»šåŠ¨é€»è¾‘ - åªæœ‰å½“ç”¨æˆ·åœ¨åº•éƒ¨é™„è¿‘æ‰è‡ªåŠ¨æ»šåŠ¨
            function autoScrollIfAtBottom() {
                const isNearBottom = logOutput.scrollHeight - logOutput.scrollTop - logOutput.clientHeight < 100; // åº•éƒ¨100pxå†…è§†ä¸ºæ¥è¿‘åº•éƒ¨
                
                if (isNearBottom) {
                    logOutput.scrollTop = logOutput.scrollHeight;
                }
            }
            
            ws.onmessage = (e) => {
                logOutput.value += e.data + '\n';
                // åªæœ‰å½“ç”¨æˆ·åœ¨åº•éƒ¨é™„è¿‘æ‰è‡ªåŠ¨æ»šåŠ¨
                autoScrollIfAtBottom();
            };
            
            // é¦–æ¬¡åŠ è½½æ—¶æ»šåŠ¨åˆ°åº•éƒ¨
            setTimeout(() => {
                logOutput.scrollTop = logOutput.scrollHeight;
            }, 100);
            // æ·»åŠ å¹³æ»‘æ»šåŠ¨
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });
            
            // æ ¹æ®URLå‚æ•°é«˜äº®ç­›é€‰æ 
            function highlightActiveFilter() {
                // è·å–URLä¸­çš„statuså‚æ•°
                const urlParams = new URLSearchParams(window.location.search);
                const currentStatus = urlParams.get('status') || 'all'; // é»˜è®¤é«˜äº®'å…¨éƒ¨çŠ¶æ€'
                
                // è·å–æ‰€æœ‰ç­›é€‰æŒ‰é’®
                const filterButtons = document.querySelectorAll('.filter-btn');
                
                // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
                filterButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // ä¸ºå½“å‰é€‰ä¸­çš„æŒ‰é’®æ·»åŠ activeç±»
                const activeButton = document.querySelector(`.filter-btn[data-status="${currentStatus}"]`);
                if (activeButton) {
                    activeButton.classList.add('active');
                }
            }
            
            // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œé«˜äº®
            document.addEventListener('DOMContentLoaded', function() {
                highlightActiveFilter();
                
                // ä¸ºç­›é€‰æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                const filterButtons = document.querySelectorAll('.filter-btn');
                filterButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        // ç‚¹å‡»åä¼šé¡µé¢åˆ·æ–°ï¼Œæ— éœ€æ‰‹åŠ¨æ›´æ–°activeçŠ¶æ€
                        // é¡µé¢åˆ·æ–°åä¼šé‡æ–°æ‰§è¡ŒhighlightActiveFilterå‡½æ•°
                    });
                });
            });
            
            // ä¸ºè¡¨æ ¼è¡Œæ·»åŠ è¿›å…¥åŠ¨ç”»
            document.addEventListener('DOMContentLoaded', function() {
                const rows = document.querySelectorAll('.list tbody tr');
                rows.forEach((row, index) => {
                    row.style.opacity = '0';
                    row.style.transform = 'translateY(20px)';
                    row.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    
                    setTimeout(() => {
                        row.style.opacity = '1';
                        row.style.transform = 'translateY(0)';
                    }, 100 * index);
                });
            });
            
        </script>
    </body>
</html>
